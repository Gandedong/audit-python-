### 前言
　　信息传递的速度越来越快，从飞鸽传书到有线电话，我们用了100年。而从有线电话到无线电话，我们用了30年，但从4G至5G，我们只用了10年。在手机的加持下，人们产生的信息也呈爆炸态势增长，而随着信息越来越多，最近几年兴起了研究大数据的热潮。
　　众所周知，大数据就是海量数据，如视频网站每天用户上传的视频数量数以万计，这个“万计”是以GB为单位吗？不，是PB为单位，即1PB等于差不多100万GB。
　　这些数据如果没有分析的话，是没用的，例如我想知道视频网站上最受欢迎的裙子，我如果不将视频数据转换为一种能比较的单一格式，如EXCEL表格，这堆大数据就对我没用的，相反，如果我做了数据分析，找出了最受欢迎的裙子，这堆大数据就有用了。
　　当前做数据分析工作的朋友，大部份人能使用Excel吧，毕竟不会用的，估计都退休了。如果某天，你需要面对的数据量是以PB为单位的Excel文件，恐怕做到退休都无法完成吧。
　　估计别人以为我是说笑，其实，这不好笑，我只说一件事，传感器越来越智能了。不谈传感器的概念，我举几个例子你就明白了，人脸识别的摄像头，蓝牙体温计，声控防盗门等等。
　　生物为了从外界获取信息，必须借助于感觉器官，而我们为了让机器从外界获取信息，发明了传感器，这样会不会好明白一点。
　　当越来越多的企业借助传感器来进行记录工作，如仓库的收发存，物流的出车记录，发票的开具工作，货款的收款记录均通过传感器来处理，这样，这些传感器产生的数据，他们每月所产生的数据就不再以GB为单位，而是以PB，EB为单位了。
　　再长远一点，如果未来是以无线信息技术为载体的话，即，无纸化+手机终端+网络云+物联网。数据的输入，存放，输出都不需经过人手处理的，并能自动记录事件的时间，地点，人物，起因，经过和结果的时候。你面对的，除了大堆的数据，还将是很多颗粒度非常细的数据沙，这个时候，你如果没有一套趁手的数据分析工具，将会举步维艰。
　　延伸到财务会计，会计是经济记录的专用语言，能反映经济业务的增减变化。如果有朝一日信息技术能将经济记录变得更加细致和深入，用更多的数据描述经济活动，那么会计这门语言可能不再单纯的记录时间、摘要、借贷，金额等的要素，还需要记录人力轨迹，天气变化，消费体验，机器故障等日新月异的要求。
　　有人认为，财务和审计中最重要的是职业判断，风控理论，而审核数据，数据分析这些工作，只是财务和审计中的一部分，不需要太重视，这我是持反对意见的。我觉得，随着技术革新促进产业结构的不断调整，固守之前的职业判断和风控理论，无疑是“刻舟求剑”。虽然现在很多行业的信息化程度不高，但不代表日后也是如此。
　　相信不少人还记得獐子岛三次上演“扇贝大逃亡”的荒唐戏码，但由于当时审计技术所限，不少人捏着鼻子认了所谓专家证实的“冷水团”，很多会计毕业生还以此汇搜集该公司2011年至2015年期间的财务报表数据，计算其结构百分比、增长率等财务指标，写了不少关于“冷水团”影响会计信息方面的论文。
　　但当獐子岛还要上演第四次“扇贝大逃亡”时，证监会出手了：委托第三方机构，借助北斗卫星导航系统，监控了獐子岛27条采捕船，对其几百万条海上航行定位数据进行分析，还原了当时真实的航行轨迹和采捕海域，拆穿了“冷水团”的谎言，进而认定獐子岛在主营业务成本、营业外支出、利润等做假。
　　北斗监控，定位数据分析，估计已经让不少的毕业论文打回修改了。
　　现在财务工作中，基本上，能用VBA处理EXCEL表，这已经是很优秀了，用powerBI或fineBI做可视化分析的，真的不多，而用Python来做数据分析的，敢挑战大数据的，更凤毛麟角了。希望能通过这本书，将一些工作的理念和实用的工具与同行分享，迎接信息化，数据化带来的挑战。

　　由于本书不是教科书，也不是理论文选，所以尽量采用轻松幽默、浅显直白的语言书写。本书没有深奥的理论，更不必说晦涩难点，为避免实战操作较多会令你“消化不良”，建议“啃书”时放松心情，慢慢品味。另外本书的代码可以在
　　本书在写作时，有 3 大特色。
　　（1）内容注重实战，介绍了信息化财务及审计所面临的各类问题，并提供相关的代码。 对于没有计算机基础的朋友，能从财务方向学习Python计算机语言及其相关库的应用。
　　（2）行文轻松幽默，以实际工作案例为引导。我从事财务工作多年，算是这一行的“老司机”，有自己的见解。本书中，我将通过实际工作中的案例，以一个老朋友话家常的形式，与读者分享。知识不是用来死记硬背，自己能理解和掌握才是最重要的。
　　（3）独有的“题外话”栏目，能激发读者的兴趣和思考，增加阅读的乐趣，本书的代码放到本人的git仓库中：https://github.com/Gandedong/audit-python。

　　本书适合财务及审计行业从业者、数据分析企业经营者，还可作为大数据培训班学员作为培训辅导教材使用。
　　因作者水平和时间有限，难免存有疏漏，但尽可能地保证干货满满，绝不渗水售假。如对本书内容有疑问，欢迎添加我的公众号“冻苹果没有虫”探讨，共同进步。


---

### 概述
　　我们当前正着着一个重大的历史节点。中美竞争的情况下，虽然中国工业在化、信息化、网络化方面的运动员交出了良好的成绩单，但现在世界上已经有了正式的进展，进入数字时代，世界也向我们写一个试卷。
  
---   
#### 1.1数据与审计
　　如果以数据量进行划分，工业时代可以被划分为大数据时代和小数据时代。目前有多很的讨论，如大数据时代与小数据时代的划分标准。而我有一些不同的想法，这个就是获取数据的成本。在20年前，获取大量的数据是一件高成本的事，我记得，想要获取客户的消费喜好，需要专业调查公司做大量的统计工作，有的公司采用抽样的方式来进行统计，有的公司采用问卷调查进行统计，无论结果如何，而且这些数据录入和输出都需要人手操作，而且，对获取数据的源头是有限制的，即我只调查1000人，或我只抽样1000人，这个是小数据时代下无可奈何的妥协。
   
　　而现在，随着智能手机，5G网速，云计算，物联网的出现，获取数据的成本已经大大降低了，以手机为例，智慧手机除了能上网之外，还是一个很好的传感器。在这一次的新冠疫情当中，出现了手机加载的“健康码”，就是大数据应用的一个例子。“健康码”其实不是证明你是否健康，而是证明你进过的超市、坐过的公交、乘过的飞机火车等，是否有高危人群。其信息来源包括公民登记、企业登记、基层登记。如果你不幸的与感染者同时进出超市，那么你的“健康码”就从绿变红了。还有，如果你去了另一个城市，手机能自动记录你去过的时间和地点，“健康码”就会自动更新。
    
　　这个时候，智能手机就是一个数据收集点，而全国几乎人手一台的情况下，数据的产生、记录和传递就比较省成本了。当18个省的出行数据通过手机网络汇总到数据中心后台，同时让各个省的数据得到数据互认，从而实现对人群流动的精准管理。
   
　　我个人认为，大数据与小数据之间并没有绝对的界限，但如果以获取成本来划分，能相对准确。毕竟，一个技术能不能得到社会的承认，很大一部分是他的成本能不能让人接受。
   
　　除手机之外，人脸识别摄像头也是一个很好的传感器，它承担着图像采集的任务，而图像采集之后，就与服务器中的数据库中行比对，如身份证数据比对。这样一来，就可以判定两个人是否为同一人。这个数据比对的过程其实也是大数据应用的过程，因为用一个人的特征去搜索14亿人的数据，这都是过去所不能达到的。
 
　　虽然大数据被炒得火热，但对于个人而言，并不会有什么帮助，记录身边的点点滴滴，手机就可以了。但对企业来说，业务的数字化，信息化是趋势，毕竟从成本上来说，能数字化的企业意味着能用更少的成本干更多的事。
   
　　过去，我们引进了OA系统、CRM系统、MRP到ERP系统等，目的是为业务的数据化，但由于很多业务是在线下展开，因此不是所有公司都能走通这条道路，又或者走通了，完全数据化十分困难。但最近几年，借智着能手机的普及，5G时代来临，物联网的应用，才有条件实现的业务的数据化，特别是电子发票的在将来的普及，这条路真的有希望打通了。而对审计和财务人员来说，他们面向企业的业务可能不是一份份的合同或者凭证，而是一条条的数据，因为业务的载体已经离开了A4纸，成为云端中的记录。
  
　　当然，我不是鼓励大家真的转行当IT，我只希望大家在财务和审计的基础上，能懂一点IT技能，提高一下工资水平，顺便适应时代的发展。

  
#### 1.2 VBA与小数据
　　在windows2.0的时代，EXCEL已经出来了，当时Windows系统只卖99美元，还捆绑了EXCEL。几年之后，EXCEL从Windows分割出来，却被捆绑到Microsoft Office中，同一时期，VBA（Visual Basic for Applications）刚刚从BASIC语言基础上开发出来，还属于非常先进的计算机语言，微软也将其内嵌在Microsoft Office，这样一来，EXCEL和VBA就走在一起了。老实说，这在当时是非常先进的，因为一个是可视化表格和一个可视化是计算机语言，两者集成在一起，使批量处理变得简单和高效，是一个划时代的标志。可以说，Microsoft Office取得巨大成功的一个重要原因就是VBA。
  
　　VBA中的B，就是Basic语言，Basic是非常亲民的语言，其诞生于70年代，是专门为非计算机人士而设的，只要英语语法过关，其本能猜到语句的含义。本人学的第一个计算机语言就是Basic，在电脑兴趣班中上三四节课，就能写一个简单点的小程序。而VBA仍然继承了Basic语言的关键字和语法，所以算是易学易用的一种语言。功能上，VBA与微软的产品融合得不错，所以在Windows系统中运行一点都不吃力。
  
　　以我的古董电脑为例，在WinXP系统下，EXCEL的工作表最大行数是10万行左右，所以如果数据量多的话，就要分成很多个工作表。如果运行一个超过50MB的Excel文件，系统会变得有点卡，如果做一个筛选后合并计算，除了执行时间长之外，还一不小心就宕机。但如果事先用VBA进行筛选后合并计算，执行时间短，而且没感觉到系统变卡。
  
　　另外，VBA可以进行批处理，例如，要将十几个分公司的花名册汇总到一张表中，简单点的就是打开所有分公司的花名册文件，然后用复制黏贴的方法将名单汇总到一张表中。但如果花名册不是十几个，而是几百个，这就麻烦了。不过，如果有VBA，可以使用FileArr函数和For…Next…语句，就可以几百个公司的花名册汇总到一张表中。
  
　　当然，这是有限制的，当一个EXCEL文件达到200MB的时候，连打开文件都变得很慢时，想查找数据，就要将EXCEL文件导入ACCESS中，进行查找。
  
　　什么是ACCESS？简单点来说就是大量EXCEL文件的查询界面，可以对大量EXCEL进行分类汇总，条件查询等，另外，ACCESS内也有VBA的，所以批量处理也不是问题。
  
　　不过问题来了，ACCESS也是有限制的，最大的上限是2GB，所以，如果文件大的话，最后还需将数据进行拆分。于是服务器级别的数据库软件出来了，知名的如Oracle、MySQL、SQL Server等，当然，这个是服务器级的，毕竟在1990年，是没有8G内存的个人电脑的，普遍是128MB的内存，能用数据库的都是大服务器。而在数据库软件之中，最贵的是Oracle，为什么？除了稳定性强外，他的功能齐全，能对数据能进行可视化分析，对大企业的决策层是非常有帮助的。
  
　　在当时，能做大数据的企业很少，连信息化都是一个比较新的概念，这个时候的VBA基本上能满足人们办公的需求，更何况，在那个年代，有人会用Excel就已经非常时髦了。但谁也没有想到，互联网真的会改变世界。

　　90年代，电商还是一件新鲜的业务，并不是所有人都看好的，除了极少数人，没人会想到电商日后的辉煌，更没有人想到有公司一天的交易量会是2000亿，一分钟的交易量会是65亿。如果还用Excel+VBA去统计当天的交易量，这将会是非常痛苦的事。
  
　　可以说，互联网催生了电商的辉煌，电商催生了为大数据需求。
  
　　2012年之后，一大堆涉及大数据的软硬件上来了，有物联网，有云计算，有区块链，还有人工智能等等，这个时候，对算法和模型有要求的人开始留意到Python这种计算机语言，而Python也因为与C语言有紧密的联系，开始成为人工智能、物联网等的核心语言。



#### 1.3	Python与大数据
　　Python与VBA不一样，它是一种解释型语言，编程涉及更少的代码行。它能够以最少的代码行执行程序。另外一个就是开源，Python作为一种开源语言，能支持多种平台。而且，它可以在Windows和Linux等各种环境中运行。
  
　　Python的受欢迎程度如下：
  ![P1 1](https://user-images.githubusercontent.com/57973589/124348481-b7749d00-dc1c-11eb-9d5d-70c6c10e49cb.png)
 
　　Python具有支持数据处理的内置功能。您可以使用此功能来支持对非结构化和非常规数据的数据处理。这就是大数据公司偏爱选择Python的原因。
  
　　例如在数据分析中，Python有pandas（熊猫）库。它能够从多个来源读取数据，并具有一些内置的可视化效果，可用于将结果绘制成图表，可将完成的分析结果转换为Excel电子表格。同时，他提供了：数值计算、数据分析、统计分析、数据可视化的功能。特别在很多的金融数据分析，经常见到他的身影。
  
　　Python的强大是建立在一系列强大的开源库上面的，无论是神经网络、智能算法、数据分析、图像处理、科学计算，都有各式各样的库在等着你用。而这些是VBA语言是没有的。
  
　　另外，与其他语言相比较，Python能与Hadoop完全兼容的。Hadoop是一个大数据框架系统，非常出名，有人说，Hadoop是大数据的代名词，这个不过分，因为Hadoop他是开源的，能用于多台计算机的，解决大量计算和处理大量数据使用的软件，特别是它能存储PB级别的文件。所以你会用Hadoop，你就成为大数据市场上最抢手的员工。
  
　　由于笔者不是做Hadoop开发的，所以就不多介绍了。
  
　　我在这里强调Python与大数据，是因为Python可以成为审计的一个探索工具，例如在审计之前，很多会计师事务所都要做风险评估程序，什么是风险评估程序呢？在回答这个之前，先说一下什么叫做“拇指规则”，这样好理解一点。
  
>“拇指规则”是指的是在农业播种时，为了达到合适的种子深度，拇指经常被用来快速地测量种子掩埋的深浅，而在经济领域，指的是经济决策者对信息的处理方式不是按照理性预期的方式，把所有获得的信息都引入到决策模型中。他们往往遵循的是：只考虑重要信息，而忽略掉其他信息。


　　是不是很熟悉？
  
　　风险评估就是审计程序当中的那只拇指，从而判断风险大小的，其中更多的是主观判断。
  
　　为什么现在还需要主观判段？这是因为时间，无错，时间不够用。
  
　　注册会计师职业是在第二次工业革命后期正式成熟的，在产业集团化的背景下，风险评估为导向的审计模式与运用方式，可以更省时间，举个例，为了证明你这批烤鸭是安全的，有人以食品安全法为原则设计了一系列的问卷调查测试，然后判断抽查的范围。如我认为这批烤鸭的安全风险是低的，我这次抽十只烤鸭进行检查，这样节省了时间。
  
　　但是，如果是风险不单独存在于食品安全，而是在禽流感的话，这样的风险就被低估了。
  
　　还好，随着信息化的发展，其实就是以信息为基础的第三次工业革命，有人提出了用大数据来解决样本不足引起的风险，即我每一只烤鸭从他从鸭蛋到烤制的过程都有数字记录的，是的，每一只鸭子，而不是十只，这样的话，审计的风险就转移了。
  
　　这个方向有很多人在探索，我也在探索之中，而Python就是一个探索工具。
  
　　不过问题是，现在大多数的计算机书籍都是由计算机专业的学者或专业人士撰写的，很少有人站在财务及审计人员的角度去写一本关于计算机语言的书，如果有人能结合财务领域的应用，介绍如何使用该计算机语言的话，应该对很多财务人员有不少的帮助。

  
##### 题外话：
>_我在上一本书其实已经写过关于增值税普通发票的电子化的内容，而从2021年开始，连增值税专用发票也开始进行电子化了，未来随着电子发票的推广，也越来越要求企业信息的传递能自动化一点。我们当财务的也清楚，如果电子发票真的能全面取代纸质发票，那么增值税申报也可能会自动化，财务的人为操作的空间将越来越少。_

>_这样的情况下，只有靠调整业务才能做好税收调控，但如果业务不能电子化，数字化的话，这就表示你只能靠人工统计，除非收入比较少，否则当业务多元化之后，你将不能控制你的利润，不能控制你的税金，所以在未来，企业的数字化将越来越重要。_

>_但企业的数字化做起来并不容易，小企业还好，如果企业有朝一日能做大做强，那么面对用工成本，面对生产效率，面对客户的需求，这是一个生存还是毁灭的问题。_

>_市场上有很多ERP系统，有的很贵，有的很便宜，为什么这样呢？因为一个工具的好坏往往不在于本身，而在于使用的环境和使用者。举个例，我是一家企业，我平时是背着有一堆业务去B市，我以前是走路去的，虽然慢一点，但努力一点也可以在太阳下山前到达的，后来我买了一台车，叫做ERP的，但去到半路就抛锚了，还要推着车走，这样就更慢更累了。主要原因是，这台车底盘没有经过调校，不适应本地的路况，还有就是业务的堆放不规范，重心不平衡，还有就是发动机没加够机油等等，一般这些问题有4S店做售后维护，有些牌子的ERP车贵，但售后好，有些牌子的ERP车便宜，但没有售后。_

>_有人会问，懂Python就可以自己设计ERP吗？这个，是可以的，国外有一个猛人就是用Python设计出一款开源的ERP系统，名字我就不说了，免得被人说打广告。我本人用过这些外国的开源ERP，毕竟免费的。我觉得这些ERP不适合中国的原因是，中国的会计习惯与外国准则是有差异的，差异之处我日后再说一下，差异之处会让会计们觉得不好用，或者非常难用，而且这个不是单纯外观设计的问题，是核心流程的问题，要改动的话，就要改代码，而且还需要调试。但不是所有的会计都懂IT的，如果懂IT的，谁还会当会计呀。_

>_不过，如果有些人手动能力强点的，能自己DIY一台ERP的话，这就不是问题了。为适应本地路况的，加高底盘，为能多拉点业务，加宽后尾箱，为能更快一点，加涡轮增压等等，这个就是ERP的二次开发了。这样是最好的，但是也是最难的，毕竟懂业务的，不一定懂IT的，懂IT的不一定懂财务的。_


